<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}–§–∏–Ω–°–µ—Ä–≤–∏—Å{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <!-- Admin Banner -->
    {% if current_user.is_authenticated and current_user.is_admin %}
    <div class="admin-banner">
        üîê –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–† –°–ò–°–¢–ï–ú–´ | –£ –≤–∞—Å –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –æ–ø–µ—Ä–∞—Ü–∏—è–º
    </div>
    {% endif %}

    <header>
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand" href="{{ url_for('index') }}">
                    üè¶ –§–∏–Ω–°–µ—Ä–≤–∏—Å
                </a>
                <div class="navbar-nav ms-auto">
                    {% if current_user.is_authenticated %}
                        <!-- –ö–Ω–æ–ø–∫–∞ –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫–∞ -->
                        <button class="btn btn-outline-info me-2" data-bs-toggle="modal" data-bs-target="#aiAssistantModal">
                            <i class="fas fa-robot me-1"></i>–ü–æ–º–æ—â–Ω–∏–∫
                        </button>
                        <span class="nav-item nav-link">üë§ {{ current_user.username }}</span>
                        <a class="nav-item nav-link" href="{{ url_for('logout') }}">–í—ã–π—Ç–∏</a>
                    {% else %}
                        <a class="nav-item nav-link" href="{{ url_for('login') }}">–í–æ–π—Ç–∏</a>
                        <a class="nav-item nav-link" href="{{ url_for('register') }}">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    {% endif %}
                </div>
            </div>
        </nav>
    </header>

    <main class="container my-4">
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-info">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 –§–∏–Ω–°–µ—Ä–≤–∏—Å. –£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç. –ù–µ —è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–º –±–∞–Ω–∫–æ–≤—Å–∫–∏–º —Å–µ—Ä–≤–∏—Å–æ–º.</p>
        </div>
    </footer>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫–∞ -->
    <div class="modal fade" id="aiAssistantModal" tabindex="-1" aria-labelledby="aiAssistantModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="aiAssistantModalLabel">
                        <i class="fas fa-robot me-2"></i>–ò–ò-–ø–æ–º–æ—â–Ω–∏–∫ –§–∏–Ω–°–µ—Ä–≤–∏—Å
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="aiQuestion" class="form-label">–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –æ —Ä–∞–±–æ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</label>
                        <textarea class="form-control" id="aiQuestion" rows="3"
                                  placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–≤–æ–¥? –ì–¥–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –æ–ø–µ—Ä–∞—Ü–∏–π? –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤–∫–ª–∞–¥–æ–≤?"></textarea>
                    </div>
                    <div id="aiResponse" class="alert alert-info" style="display: none;">
                        <strong>–û—Ç–≤–µ—Ç:</strong>
                        <div id="responseText"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                    <button type="button" class="btn btn-primary" id="askAIButton" onclick="askAI()">
                        <i class="fas fa-paper-plane me-1"></i>–°–ø—Ä–æ—Å–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
    function askAI() {
        const question = document.getElementById('aiQuestion').value.trim();
        const askButton = document.getElementById('askAIButton');
        const responseDiv = document.getElementById('aiResponse');
        const responseText = document.getElementById('responseText');

        if (!question) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å');
            return;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        askButton.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>–û–±—Ä–∞–±–æ—Ç–∫–∞...';
        askButton.disabled = true;

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        fetch('/run-ai', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                outcome: [question]
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.results && data.results.length > 0) {
                responseText.textContent = data.results[0].result;
                responseDiv.style.display = 'block';
            } else {
                responseText.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.';
                responseDiv.style.display = 'block';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            responseText.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å–µ—Ä–≤–µ—Ä—É.';
            responseDiv.style.display = 'block';
        })
        .finally(() => {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            askButton.innerHTML = '<i class="fas fa-paper-plane me-1"></i>–°–ø—Ä–æ—Å–∏—Ç—å';
            askButton.disabled = false;
        });
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –ø–æ–ª–µ
    document.getElementById('aiQuestion').addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            askAI();
        }
    });

    // –û—á–∏—Å—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    document.getElementById('aiAssistantModal').addEventListener('show.bs.modal', function() {
        document.getElementById('aiResponse').style.display = 'none';
        document.getElementById('aiQuestion').value = '';
    });
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>